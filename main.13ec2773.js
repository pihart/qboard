(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{22:function(e,t){},23:function(e,t){},24:function(e,t){},39:function(e,t,s){},40:function(e,t,s){"use strict";s.r(t);var a,i=s(0),n=s.n(i),c=s(7),l=s.n(c),r=s(3),o=s.n(r),h=s(2);!function(e){e.PreviousPage="previousPage",e.NextPage="nextPage",e.AddPage="addPage",e.Undo="undo",e.Redo="redo",e.Open="open",e.Save="save",e.Export="export",e.Cut="cut",e.Copy="copy",e.Paste="paste",e.Deselect="deselect",e.SelectAll="selectAll",e.Duplicate="duplicate",e.Move="move",e.Pen="pen",e.Eraser="eraser",e.Laser="laser",e.Line="line",e.Ellipse="ellipse",e.Rectangle="rectangle",e.Dotted="dotted",e.Dashed="dashed",e.Solid="solid",e.Black="black",e.Blue="blue",e.Green="green",e.Orange="orange",e.Yellow="yellow",e.Transparent="transparent",e.HalfFilled="halfFilled",e.Filled="filled",e.ResetStyles="resetStyles",e.FullScreen="fullScreen",e.EnterFullScreen="enterFullScreen",e.ExitFullScreen="exitFullScreen"}(a||(a={}));const d={previousPage:"–Page",nextPage:"+Page",addPage:"+Page",selectAll:"Select All",duplicate:"Clone",eraser:"Cut / Eraser",rectangle:"Rect.",transparent:"Unfilled",halfFilled:"Half Fill",resetStyles:"Reset Styles",fullScreen:"Full Screen",enterFullScreen:"Enter Full Screen",exitFullScreen:"Exit Full Screen"},u=e=>{const t=d[e]||e;return t&&t[0].toUpperCase()+t.slice(1)};class m{constructor(e,t,s,i,n,c,l){this.switchTool=e,this.currentStyle=t,this.pages=s,this.files=i,this.history=n,this.clipboard=c,this.setStyle=l,this.doAction=async e=>this.actionMap[e](),this.setDash=async e=>{e===this.currentStyle.dash?this.setStyle(0,null,null):this.setStyle(e,null,null)},this.setStroke=async e=>{e===this.currentStyle.stroke?this.setStyle(null,"#000000",null):this.setStyle(null,e,null)},this.setFill=async e=>{e===this.currentStyle.fill?this.setStyle(null,null,0):this.setStyle(null,null,e)},this.canvas=this.pages.canvas,this.actionMap={previousPage:s.previousPage,nextPage:s.nextOrNewPage,addPage:s.nextOrNewPage,undo:n.undo,redo:n.redo,open:i.openFile,save:s.saveFile,export:s.export,cut:c.cut,copy:c.copy,paste:c.paste,deselect:()=>{this.canvas.discardActiveObject(),this.canvas.requestRenderAll()},selectAll:()=>{this.canvas.discardActiveObject(),this.canvas.setActiveObject(new h.fabric.ActiveSelection(this.canvas.getObjects(),{canvas:this.canvas})),this.canvas.requestRenderAll()},duplicate:()=>this.clipboard.copy().then(()=>this.clipboard.paste()),move:()=>this.switchTool(0),pen:()=>this.switchTool(1),eraser:()=>this.switchTool(2),laser:()=>this.switchTool(3),line:()=>this.switchTool(4),ellipse:()=>this.switchTool(6),rectangle:()=>this.switchTool(5),dotted:()=>this.setDash(2),dashed:()=>this.setDash(1),solid:()=>this.setDash(0),blue:()=>this.setStroke("#0097f6"),green:()=>this.setStroke("#00b253"),yellow:()=>this.setStroke("#ffbf00"),orange:()=>this.setStroke("#ff2600"),black:()=>this.setStroke("#000000"),transparent:()=>this.setFill(0),halfFilled:()=>this.setFill(2),filled:()=>this.setFill(1),resetStyles:()=>this.setStyle(0,"#000000",0),fullScreen:()=>this.doAction(document.fullscreenElement?a.ExitFullScreen:a.EnterFullScreen),enterFullScreen:()=>document.documentElement.requestFullscreen(),exitFullScreen:()=>document.exitFullscreen()}}}const p={q:a.Laser,w:a.Copy,e:a.Blue,esc:a.Deselect,r:a.Green,a:a.PreviousPage,s:a.NextPage,d:a.Pen,f:a.Undo,g:a.Paste,z:a.ResetStyles,x:a.Eraser,c:a.Line,v:a.Move,"shift + q":a.Dotted,"shift + w":a.Transparent,"shift + e":a.Ellipse,"shift + r":a.Rectangle,"shift + a":a.Dashed,"shift + s":a.HalfFilled,"shift + d":a.Black,"shift + f":a.Redo,"shift + z":a.Solid,"shift + x":a.Filled,"shift + c":a.Yellow,"shift + v":a.Orange,"ctrl + a":a.SelectAll,"ctrl + s":a.Save,"ctrl + d":a.Duplicate,"ctrl + z":a.Undo,"ctrl + x":a.Cut,"ctrl + c":a.Copy},v={tab:"[",q:"p",w:"o",e:"i",r:"u",t:"y",esc:"'",a:";",s:"l",d:"k",f:"j",g:"h",shift:"shift",z:"/",x:".",c:",",v:"m",b:"n"},y=e=>v[e]||e.slice(0,-1)+v[e.slice(-1)];class b{constructor(e,t,s){this.doAction=e,this.setStrict=t,this.updateState=s,this.keyMap={},this.save=()=>{window.localStorage.setItem("keyMap",JSON.stringify(this.keyMap))},this.bindAll=()=>{for(const[e,t]of Object.entries(this.keyMap))this.bind(e,t);this.updateState()},this.unbind=e=>{delete this.keyMap[e],o.a.unbind(e),o.a.unbind(y(e)),this.updateState(),this.save()},this.bind=(e,t)=>{this.keyMap[e]=t,o.a.bind(e,()=>this.doAction(this.keyMap[e])),o.a.bind(y(e),()=>this.doAction(this.keyMap[e])),this.updateState(),this.save()},this.reset=()=>{for(const e of Object.keys(this.keyMap))o.a.unbind(e),o.a.unbind(y(e));this.keyMap={...p},this.bindAll(),this.save()},o.a.bind("shift",()=>{this.setStrict(!0)},()=>{this.setStrict(!1)}),window.localStorage.getItem("keyMap")?(this.keyMap=JSON.parse(window.localStorage.getItem("keyMap")),this.bindAll()):this.reset()}}var g=s(13);const f=(e,t)=>n.a.createElement("i",{className:"fas fa-"+e,style:t});var w={close:f("times-circle"),previousPage:f("caret-left"),nextPage:f("caret-right"),addPage:f("plus",{transform:"scale(0.7)"}),undo:f("undo"),redo:f("redo"),move:f("mouse-pointer"),pen:f("pen"),eraser:f("eraser"),laser:f("asterisk"),line:f("minus",{transform:"rotate(-45deg)"}),ellipse:f("circle"),rectangle:f("square"),file:f("file"),open:f("folder-open"),save:f("save"),export:f("file-export"),cut:f("cut"),copy:f("copy"),paste:f("paste"),duplicate:f("clone"),fullScreen:f("expand"),enterFullScreen:f("expand"),exitFullScreen:f("compress"),black:f("circle",{color:"#000000"}),blue:f("circle",{color:"#0097f6"}),green:f("circle",{color:"#00b253"}),orange:f("circle",{color:"#ff2600"}),yellow:f("circle",{color:"#ffbf00"}),dotted:n.a.createElement("svg",{viewBox:"0 0 21 21",style:{width:"1em",height:"1.1em"}},n.a.createElement("g",{transform:"translate(-90 -1158)"},n.a.createElement("g",null,n.a.createElement("path",{d:"M104.184,1164.401l1.43-1.43c-1.294-1.035-2.878-1.721-4.613-1.913v2.021    C102.184,1163.25,103.27,1163.716,104.184,1164.401z"}),n.a.createElement("path",{d:"M95.816,1175.599l-1.43,1.43c1.294,1.035,2.878,1.721,4.613,1.913v-2.021C97.816,1176.75,96.73,1176.284,95.816,1175.599z"}),n.a.createElement("path",{d:"M94.401,1165.815l-1.429-1.43c-1.036,1.295-1.723,2.879-1.914,4.614h2.021    C93.25,1167.817,93.716,1166.731,94.401,1165.815z"}),n.a.createElement("path",{d:"M106.92,1171c-0.17,1.183-0.636,2.269-1.322,3.185l1.43,1.43c1.036-1.295,1.723-2.879,1.914-4.614H106.92z"})))),dashed:n.a.createElement("svg",{viewBox:"0 0 21 21",style:{width:"1em",height:"1.1em"}},n.a.createElement("g",{transform:"translate(-90 -1158)"},n.a.createElement("g",null,n.a.createElement("path",{d:"M101,1176.92v2.021c1.735-0.192,3.319-0.878,4.613-1.913l-1.43-1.43C103.269,1176.284,102.183,1176.75,101,1176.92z"}),n.a.createElement("path",{d:"M93.08,1171h-2.021c0.191,1.735,0.879,3.319,1.914,4.614l1.43-1.43C93.716,1173.269,93.25,1172.183,93.08,1171z"}),n.a.createElement("path",{d:"M104.184,1164.401l1.43-1.43c-1.294-1.035-2.878-1.721-4.613-1.913v2.021    C102.184,1163.25,103.27,1163.716,104.184,1164.401z"}),n.a.createElement("path",{d:"M106.92,1169h2.021c-0.191-1.735-0.879-3.319-1.914-4.614l-1.43,1.43C106.284,1166.731,106.75,1167.817,106.92,1169z"}),n.a.createElement("path",{d:"M95.816,1175.599l-1.43,1.43c1.294,1.035,2.878,1.721,4.613,1.913v-2.021C97.816,1176.75,96.73,1176.284,95.816,1175.599z"}),n.a.createElement("path",{d:"M94.401,1165.815l-1.429-1.43c-1.036,1.295-1.723,2.879-1.914,4.614h2.021    C93.25,1167.817,93.716,1166.731,94.401,1165.815z"}),n.a.createElement("path",{d:"M99,1163.08v-2.021c-1.735,0.192-3.319,0.878-4.613,1.913l1.43,1.43C96.731,1163.716,97.817,1163.25,99,1163.08z"}),n.a.createElement("path",{d:"M106.92,1171c-0.17,1.183-0.636,2.269-1.322,3.185l1.43,1.43c1.036-1.295,1.723-2.879,1.914-4.614H106.92z"})))),solid:n.a.createElement("i",{className:"far fa-circle"}),transparent:n.a.createElement("i",{className:"far fa-circle"}),halfFilled:n.a.createElement("div",{style:{height:"0.7em",marginRight:"1em",position:"relative"}},n.a.createElement("i",{className:"fas fa-circle",style:{left:"50%",opacity:.3,position:"absolute",top:0}}),n.a.createElement("i",{className:"far fa-circle",style:{left:"50%",position:"absolute",top:0}})),filled:f("circle"),resetStyles:null};var S=e=>n.a.createElement(n.a.Fragment,null,n.a.createElement("button",{className:e.className||void 0,"data-tip":!0,"data-for":e.action,onClick:()=>e.callback(e.action)},w[e.action]),n.a.createElement(g.a,{backgroundColor:"#ddd",effect:"solid",id:e.action,place:"right",textColor:"#262626"},u(e.action)));var E=e=>{const[t,s]=Object(i.useState)(0),[c,l]=Object(i.useState)("0.6em");Object(i.useEffect)(()=>{s(e.currentPage),l(.6*e.currentPage.toString().length+"em")},[e]);const r=async()=>{if(!t)return;const a=Number(t);!a||a>e.totalPages?s(e.currentPage):await e.loadPage(a-1)};Object(i.useEffect)(()=>{r()},[t]);return n.a.createElement("div",{className:"pagination visibility-"+e.visibility},n.a.createElement(S,{className:1===e.currentPage?"disabled":void 0,action:a.PreviousPage,callback:e.doAction}),n.a.createElement("form",{onSubmit:e=>(null==e||e.preventDefault(),r())},n.a.createElement("input",{onChange:e=>s(e.target.value),type:"text",value:t,style:{width:c},tabIndex:-1})),n.a.createElement("span",{className:"total-pages"}," / ",e.totalPages),e.currentPage===e.totalPages?n.a.createElement(S,{action:a.AddPage,callback:e.doAction}):n.a.createElement(S,{action:a.NextPage,callback:e.doAction}))};var k=e=>n.a.createElement("div",{className:"undoredo visibility-"+e.visibility},n.a.createElement(S,{action:a.Undo,callback:e.doAction,className:e.canUndo?void 0:"disabled"}),n.a.createElement(S,{action:a.Redo,callback:e.doAction,className:e.canRedo?void 0:"disabled"}));var O=e=>{const t=[a.Move,a.Pen,a.Eraser,a.Laser,a.Line,a.Rectangle,a.Ellipse];return n.a.createElement("div",{className:"toolbar visibility-"+e.visibility},t.map((t,s)=>n.a.createElement(S,{action:t,callback:e.doAction,className:s===e.currentTool?"active":void 0,key:t})))};var x=e=>n.a.createElement("div",{className:`button-row ${e.cName} ${e.outerButton?"button-row-hover":""}`},e.outerButton,n.a.createElement("div",{className:"button-row-inner"},e.actions.map((t,s)=>{var a;return n.a.createElement(S,{action:t,className:null===(a=e.className)||void 0===a?void 0:a.call(e,t,s),callback:e.callback,key:t})})));const A=e=>{const t=[a.Solid,a.Dashed,a.Dotted],s=n.a.createElement("button",{className:"inactive"},w[t[e.dashStyle]]);return n.a.createElement(x,{actions:t,className:(t,s)=>e.inContext&&e.dashStyle===s&&"active",callback:e.callback,outerButton:!e.inContext&&s})},P=e=>{const t=[a.Black,a.Blue,a.Green,a.Yellow,a.Orange],s=["#000000","#0097f6","#00b253","#ffbf00","#ff2600"],i=n.a.createElement("button",{className:"inactive"},n.a.createElement("i",{className:"fas fa-circle",style:{color:e.strokeStyle}}));return n.a.createElement(x,{actions:t,className:(t,a)=>e.inContext&&e.strokeStyle===s[a]&&"active",callback:e.callback,outerButton:!e.inContext&&i})},C=e=>{const t=[a.Transparent,a.Filled,a.HalfFilled],s=n.a.createElement("button",{className:"inactive"},w[t[e.fillStyle]]);return n.a.createElement(x,{actions:t,className:(t,s)=>e.inContext&&e.fillStyle===s&&"active",callback:e.callback,outerButton:!e.inContext&&s})};var N=e=>n.a.createElement(n.a.Fragment,null,n.a.createElement(A,{dashStyle:e.currentStyle?e.currentStyle.dash:null,callback:e.doAction,inContext:e.inContext}),n.a.createElement(P,{strokeStyle:e.currentStyle?e.currentStyle.stroke:null,callback:e.doAction,inContext:e.inContext}),n.a.createElement(C,{fillStyle:e.currentStyle?e.currentStyle.fill:null,callback:e.doAction,inContext:e.inContext}));var j=e=>{const t=Object(i.useRef)(null),s=n.a.createElement("button",{className:"inactive"},w.file),c=[a.Open,a.Save,a.Export],l=[a.Copy,a.Paste],r=e.isMobile?[a.FullScreen]:[],[o,h]=Object(i.useState)(!1);return Object(i.useEffect)(()=>{h(Boolean(document.fullscreenElement)),document.addEventListener("fullscreenchange",()=>h(Boolean(document.fullscreenElement)))},[]),n.a.createElement("div",{className:"stylebar visibility-"+e.visibility},n.a.createElement("input",{accept:"",onChange:t=>e.acceptFile(t.target.files),multiple:!1,ref:t,type:"file"}),n.a.createElement(x,{actions:c,callback:async s=>{s===a.Open?t.current.click():await e.doAction(s)},cName:"file-actions",outerButton:s}),n.a.createElement(x,{actions:l,cName:"other-actions vertical",callback:e.doAction}),n.a.createElement(N,{currentStyle:e.currentStyle,doAction:e.doAction}),n.a.createElement(x,{actions:r.map(e=>e===a.FullScreen?o?a.ExitFullScreen:a.EnterFullScreen:e),callback:e.doAction,cName:"mobile-actions vertical"}))},M=s(4),F=s.n(M);F.a.setAppElement("#Overlay");const D=[a.AddPage,a.EnterFullScreen,a.ExitFullScreen];var R=e=>n.a.createElement(F.a,{className:"modal",overlayClassName:"modal-overlay binding-modal",isOpen:""!==e.letter},n.a.createElement("button",{className:"close",onClick:()=>e.close()},w.close),n.a.createElement("p",null,"Changing ",n.a.createElement("span",{className:"binding"},e.letter)," binding…"),n.a.createElement("div",{className:"tools"},n.a.createElement("button",{className:void 0===e.action?"active":void 0,onClick:()=>e.callback(null)},n.a.createElement("span",{style:{left:"0.25em"}},"none")),Object.values(a).map(t=>!D.includes(t)&&n.a.createElement("button",{key:t,className:e.action===t?"active":void 0,onClick:()=>e.callback(t)},w[t],n.a.createElement("span",{style:w[t]?{}:{left:"0.25em"}},u(t))))));F.a.setAppElement("#Overlay");const T=e=>n.a.createElement("div",{className:"key",style:{width:e.width}},n.a.createElement("span",{className:"letter"},e.leftHanded?y(e.letter):e.letter),n.a.createElement("div",{className:"action"},n.a.createElement("span",{className:"unassigned"},e.label||""))),B=e=>n.a.createElement("button",{className:"key",onClick:()=>e.callback(e.letter)},n.a.createElement("div",{className:"action"},e.action&&w[e.action],n.a.createElement("span",{className:e.action?void 0:"unassigned"},u(e.action)||"none")),n.a.createElement("span",{className:"letter"},e.leftHanded?y(e.letter):e.letter));var I=e=>{const[t,s]=Object(i.useState)(""),[a,c]=Object(i.useState)(void 0),l=[{header:n.a.createElement(T,{letter:"tab",label:"Hide Toolbar",width:"4.5em",leftHanded:e.leftHanded}),letters:"qwert".split("")},{header:n.a.createElement(T,{letter:"esc",label:"Deselect",width:"6em",leftHanded:e.leftHanded}),letters:"asdfg".split("")},{header:n.a.createElement(T,{letter:"shift",label:"Snap",width:"7.5em",leftHanded:e.leftHanded}),letters:"zxcvb".split("")}],r=t=>""===e.modifier?t:`${e.modifier} + ${t}`,o=t=>{s(r(t)),c(e.keyMap[r(t)])};return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"bindings"},l.map(({header:t,letters:s},a)=>n.a.createElement("div",{className:"row "+(e.leftHanded?"left":""),key:a},!e.leftHanded&&t,(e.leftHanded?s.reverse():s).map(t=>n.a.createElement(B,{key:t,letter:t,action:e.keyMap[r(t)],callback:o,leftHanded:e.leftHanded})),e.leftHanded&&t))),n.a.createElement(R,{letter:t,action:a,close:()=>s(""),callback:a=>{e.unbind(t),a&&e.bind(t,a),s("")}}))};F.a.setAppElement("#Overlay");var H=e=>{const[t,s]=Object(i.useState)(""),[a,c]=Object(i.useState)(!1);return Object(i.useEffect)(()=>{"true"===window.localStorage.getItem("leftHanded")&&c(!0)},[]),n.a.createElement(F.a,{className:"modal",overlayClassName:"modal-overlay help-modal",isOpen:e.isOpen},n.a.createElement("button",{className:"close",onClick:()=>e.toggleOpen()},w.close),n.a.createElement("p",null,n.a.createElement("span",{style:{fontSize:"1.5em",fontWeight:"bold"}},"qboard")," ",n.a.createElement("span",{style:{color:"#666",marginLeft:"0.2em"}},"The efficient digital whiteboard.")),n.a.createElement("p",null,"Press ",n.a.createElement("b",null,a?"0":"1")," to show or hide this screen."),n.a.createElement("p",null,n.a.createElement("button",{className:""===t?"active":void 0,onClick:()=>s("")},"unmodified"),n.a.createElement("button",{className:"shift"===t?"active":void 0,onClick:()=>s("shift")},"with shift"),n.a.createElement("button",{className:"ctrl"===t?"active":void 0,onClick:()=>s("ctrl")},"with ctrl"),n.a.createElement("button",{onClick:()=>{c(e=>(window.localStorage.setItem("leftHanded",e?"false":"true"),!e))}},a?"show left side":"show right side")),n.a.createElement(I,{bind:e.bind,unbind:e.unbind,keyMap:e.keyMap,modifier:t,leftHanded:a}),n.a.createElement("p",null,"Click a key to change the binding."," ",n.a.createElement("button",{onClick:()=>e.reset()},"reset to default")),n.a.createElement("p",{style:{color:"#666"}},"By ",n.a.createElement("a",{href:"https://cjquines.com/"},"CJ Quines"),". View on"," ",n.a.createElement("a",{href:"https://github.com/cjquines/qboard"},"Github"),". Use"," ",n.a.createElement("a",{onClick:()=>e.toggleMobility(),tabIndex:0},e.isMobile?"desktop":"mobile"," site"),"."))};var z=e=>{const[t,s]=Object(i.useState)(null);return Object(i.useEffect)(()=>{document.addEventListener("contextmenu",e=>{e.preventDefault(),s(t=>t?null:[e.clientX,e.clientY])}),document.addEventListener("click",()=>s(null))},[]),t?n.a.createElement("div",{className:"context-menu",style:{top:`calc(${t[1]}px - 2.8em)`,left:`calc(${t[0]}px - 1.1em)`}},n.a.createElement(N,{currentStyle:e.currentStyle,doAction:t=>e.doAction(t),inContext:!0})):null};var q=e=>{const{qboard:t}=e,[s,a]=Object(i.useState)(2),[c,l]=Object(i.useState)(!1),[r,h]=Object(i.useState)(!1),[d,u]=Object(i.useState)({dragActive:!1,currentPage:0,totalPages:0,currentTool:0,currentStyle:{dash:0,stroke:"#000000",fill:0},canUndo:!1,canRedo:!1,keyMap:p}),m=()=>{l(e=>(window.localStorage.setItem("helpModalOpen",e?"false":"true"),!e))};return Object(i.useEffect)(()=>{"false"!==window.localStorage.getItem("helpModalOpen")&&l(!0),"false"!==window.localStorage.getItem("isMobile")&&h(!0),t.callback=u,t.updateState(),o.a.bind("tab",()=>{a(e=>(e+2)%3)}),o.a.bind("1",()=>m()),o.a.bind("0",()=>m())},[]),n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"drop-area "+(d.dragActive?"active":"")}),n.a.createElement("div",{className:"overlay visibility-"+s},n.a.createElement(E,{loadPage:t.pages.loadPage,currentPage:d.currentPage,totalPages:d.totalPages,doAction:t.action.doAction,visibility:s}),n.a.createElement(k,{canUndo:d.canUndo,canRedo:d.canRedo,doAction:t.action.doAction,visibility:s}),n.a.createElement(O,{currentTool:d.currentTool,doAction:t.action.doAction,visibility:s}),n.a.createElement(j,{currentStyle:d.currentStyle,doAction:t.action.doAction,acceptFile:async e=>t.history.execute((await t.files.acceptFile(e)).history),visibility:s,isMobile:r}),n.a.createElement(H,{bind:t.keyboard.bind,unbind:t.keyboard.unbind,reset:t.keyboard.reset,keyMap:d.keyMap,isOpen:c,toggleOpen:m,isMobile:r,toggleMobility:()=>{h(e=>(window.localStorage.setItem("isMobile",e?"false":"true"),!e))}})),n.a.createElement(z,{currentStyle:d.currentStyle,doAction:t.action.doAction}))};const J=(e,t,s,a,i)=>e.map(e=>((e,t,s,a,i,n)=>{const c=i-e,l=n-t,r=s*l-a*c,o=s*s+a*a;return[Math.abs(r)/o,e+c+a*r/o,t+l-s*r/o]})(t,s,e[0],e[1],a,i)).reduce((e,t)=>e[0]<t[0]?e:t);const U=[new class{constructor(){this.tool=0,this.isBrush=!1}},new class{constructor(){this.tool=1,this.isBrush=!0,this.setBrush=async(e,t)=>{e.color=t.stroke,e.strokeDashArray=t.strokeDashArray,e.width=t.strokeWidth}}},new class{constructor(){this.tool=2,this.isBrush=!0,this.setBrush=async(e,t)=>{e.color="#ff005455",e.strokeDashArray=[0,0],e.width=5*t.strokeWidth}}},new class{constructor(){this.tool=3,this.isBrush=!0,this.setBrush=async(e,t)=>{e.color="#f23523",e.strokeDashArray=[0,0],e.width=t.strokeWidth}}},new class{constructor(){this.tool=4,this.isBrush=!1,this.dirs=[[1,0],[1,1],[0,1],[-1,1]],this.draw=async(e,t,s,a,i)=>(this.x=e,this.y=t,new Promise(n=>{n(new h.fabric.Line([e,t,a,i],{...s,perPixelTargetFind:!0}))})),this.resize=async(e,t,s,a)=>{let[i,n]=[t,s];return a&&([,i,n]=J(this.dirs,this.x,this.y,t,s)),e.set({x2:i,y2:n}).setCoords(),new Promise(t=>{t(e)})}}},new class{constructor(){this.tool=5,this.isBrush=!1,this.dirs=[[1,1],[-1,1]],this.draw=async(e,t,s,a,i)=>(this.x=e,this.y=t,new Promise(n=>{n(new h.fabric.Rect({left:e,top:t,width:a,height:i,...s}))})),this.resize=async(e,t,s,a)=>{let[i,n]=[t,s];return a&&([,i,n]=J(this.dirs,this.x,this.y,t,s)),e.set({originX:this.x>i?"right":"left",originY:this.y>n?"bottom":"top",width:Math.abs(this.x-i),height:Math.abs(this.y-n)}).setCoords(),new Promise(t=>{t(e)})}}},new class{constructor(){this.tool=6,this.isBrush=!1,this.dirs=[[1,1],[-1,1]],this.draw=async(e,t,s,a,i)=>(this.x=e,this.y=t,new Promise(n=>{n(new h.fabric.Ellipse({left:e,top:t,rx:a,ry:i,...s}))})),this.resize=async(e,t,s,a)=>{let[i,n]=[t,s];return a&&([,i,n]=J(this.dirs,this.x,this.y,t,s)),e.set({originX:this.x>i?"right":"left",originY:this.y>n?"bottom":"top",rx:Math.abs(i-e.left)/2,ry:Math.abs(n-e.top)/2}).setCoords(),new Promise(t=>{t(e)})}}}];class L extends h.fabric.Canvas{constructor(){super(...arguments),this.latestId=0,this.modified=!1,this.fitToWindow=async(e,t)=>{const s=window.innerWidth/e,a=window.innerHeight/t;this.setZoom(Math.min(s,a)),this.setWidth(e*this.getZoom()),this.setHeight(t*this.getZoom()),this.canvasWidth=e,this.canvasHeight=t},this.deactivateSelection=async()=>{this.isDrawingMode=!1,this.selection=!1,this.discardActiveObject(),this.forEachObject(e=>{e.selectable=!1}),this.requestRenderAll()},this.activateSelection=async()=>{this.isDrawingMode=!1,this.selection=!0,this.forEachObject(e=>{e.selectable=!0})},this.getNextId=async()=>(this.latestId+=1,this.latestId),this.getObjectByIds=e=>{if(e.length>1)return this.getObjects().filter(t=>e.includes(t.id));const[t]=e;for(const e of this.getObjects())if(e.id===t)return[e];return[]},this.serialize=async e=>{const t=this.getActiveObjects(),s=t.length>1&&e.some(e=>t.includes(e));s&&this.discardActiveObject();const a=e.map(e=>e.toObject(["strokeUniform"]));return s&&this.setActiveObject(new h.fabric.ActiveSelection(t,{canvas:this})),a},this.apply=(e,t)=>{const s=this.getObjectByIds(e);if(s.length&&this.remove(...s),null==t?void 0:t.length){const s=t=>{t.forEach((t,s)=>{t.id=e[s]}),this.add(...t),this.requestRenderAll()};h.fabric.util.enlivenObjects(t,s,"fabric")}else this.requestRenderAll()},this.loadFromJSONAsync=async e=>new Promise(t=>{super.loadFromJSON(e,()=>{t()})}),this.placeObject=async(e,t=this.cursor)=>{const{x:s=this.canvasWidth/2,y:a=this.canvasHeight/2}=t||{};this.discardActiveObject();const i=await this.getNextId();return e.set({id:i,left:s,top:a,originX:"center",originY:"center"}),e._objects?(e.canvas=this,e.forEachObject(e=>this.getNextId().then(t=>{e.id=t,this.add(e)})),e.setCoords()):this.add(e),this.setActiveObject(e),this.requestRenderAll(),e._objects||[e]}}}var W=s(12),Y=s.n(W);class ${}$.readAsText=e=>new Promise((t,s)=>{const a=new FileReader;a.onload=()=>{t(a.result)},a.onerror=s,a.readAsText(e)}),$.readAsDataURL=e=>new Promise((t,s)=>{const a=new FileReader;a.onload=()=>{t(a.result)},a.onerror=s,a.readAsDataURL(e)});class G{static read(e){const t=JSON.parse(e.toString());return G.readParsed(t)}static readParsed(e){const{"qboard-version":t,pages:s}=e;switch(t){case 1:default:return s}}}class X{constructor(e){this.toString=()=>(void 0!==this.stringified||(this.stringified=JSON.stringify(this.sourceJSON)),this.stringified),this.toBlob=()=>new Blob([this.toString()],{type:"application/json"}),this.toURL=()=>{const e=window.URL.createObjectURL(this.toBlob());return[e,()=>window.URL.revokeObjectURL(e)]},this.sourceJSON={"qboard-version":1,pages:e}}}class _{constructor(e){this.pages=e,this.processFiles=async(e,t)=>{const s=[];return await Promise.all([...e].map(async e=>{if(e.type.startsWith("image/")&&s.push(await this.handleImage(e,t)),"application/json"===e.type)return this.handleJSON(e)})),{add:s.flat()}},this.acceptFile=async(e,t)=>{if(!e.length)return{action:"none"};const[s]=e;return s.type.startsWith("image/")?{action:"image",history:{add:await this.handleImage(s,t)}}:"application/json"===s.type?(await this.openFile(s),{action:"json",history:{clear:[!0]}}):{action:"none"}},this.openFile=async e=>(this.pages.savePage(),this.pages.overwritePages(G.read(await $.readAsText(e)))),this.handleImage=async(e,t)=>new Promise(s=>$.readAsDataURL(e).then(e=>h.fabric.Image.fromURL(e.toString(),e=>{s(this.pages.canvas.placeObject(e,t))}))),this.handleJSON=async e=>{const t=G.read(await $.readAsText(e));return this.pages.insertPages(this.pages.currentIndex+1,t)}}}const Q={version:"4.2.0",objects:[],background:"white"},Z=()=>{const e=6e4*(new Date).getTimezoneOffset();return new Date(Date.now()-e).toISOString().slice(0,-8).replace(/\D/g,"-")};class V{constructor(e,t,s,a,i=[Q]){this.canvas=e,this.canvasWidth=t,this.canvasHeight=s,this.updateState=a,this.pagesJSON=i,this.currentIndex=0,this.savePage=()=>{this.pagesJSON[this.currentIndex]=this.canvas.toObject(["id","strokeUniform"])},this.loadPage=async(e,t=!1,s=!1)=>e!==this.currentIndex||s?(t||this.savePage(),await this.canvas.loadFromJSONAsync(this.pagesJSON[e]),this.currentIndex=e,t&&!s||this.updateState(),e):e,this.newPage=async(e=!1)=>(this.pagesJSON.splice(this.currentIndex+1,0,Q),this.loadPage(this.currentIndex+1,e)),this.previousPage=async()=>0===this.currentIndex?0:this.loadPage(this.currentIndex-1),this.nextOrNewPage=async(e=!1)=>this.currentIndex===this.pagesJSON.length-1?this.newPage(e):this.loadPage(this.currentIndex+1,e),this.export=async()=>{this.savePage();const e=[],t=this.currentIndex;for(const t of this.pagesJSON)await this.canvas.loadFromJSONAsync(t),e.push({svg:this.canvas.toSVG(),width:this.canvasWidth/2});const s={pageSize:{width:this.canvasWidth/2,height:this.canvasHeight/2},pageMargins:[0,0],content:e};Y.a.createPdf(s).download(`qboard-${Z()}.pdf`),await this.canvas.loadFromJSONAsync(this.pagesJSON[t])},this.saveFile=()=>{this.savePage();const[e,t]=new X(this.pagesJSON).toURL(),s=document.createElement("a");s.style.display="none",s.href=e,s.download=`qboard-${Z()}.json`,document.body.appendChild(s),s.click(),s.parentElement.removeChild(s),t(),this.canvas.modified=!1},this.overwritePages=async(e=[Q])=>!(this.canvas.modified&&!this.pagesJSON.every(e=>0===e.objects.length)&&!window.confirm("Your work will be overwritten. Are you sure you wish to continue?"))&&(this.pagesJSON=e,await this.loadPage(0,!0,!0),this.canvas.modified=!1,!0),this.insertPages=async(e,t)=>(this.pagesJSON.splice(e,0,...t),this.canvas.modified=!0,this.loadPage(e))}}class K{constructor(e,t,s){this.canvas=e,this.pages=t,this.updateState=s,this.history=[],this.redoStack=[],this.locked=!1,this.execute=async(e={})=>{e.clear&&this.clear(e.clear[0]);const t=[this.add(e.add),this.remove(e.remove)];return Promise.all(t)},this.add=async e=>(null==e?void 0:e.length)&&this.save(null,e),this.remove=async e=>(null==e?void 0:e.length)&&this.save(e,null),this.clear=(e=!1)=>{this.history=[],e&&(this.redoStack=[]),this.updateState()},this.store=async e=>{this.locked||(this.locked=!0,this.selection=await this.canvas.serialize(e),this.locked=!1)},this.modify=async e=>this.save(this.selection,e),this.save=async(e,t)=>{if(this.locked)return;const s=t||e;this.locked=!0,this.history.push({ids:s.map(e=>e.id),oldObjects:t?e:await this.canvas.serialize(e),newObjects:t&&await this.canvas.serialize(t),page:this.pages.currentIndex}),this.locked=!1,this.redoStack=[],this.canvas.modified=!0,this.updateState()},this.undo=async()=>{this.history.length&&(this.canvas.discardActiveObject(),await this.move(this.history,this.redoStack,!0))},this.redo=async()=>{this.redoStack.length&&await this.move(this.redoStack,this.history,!1)},this.move=async(e,t,s)=>{this.locked=!0;const a=e.pop();await this.pages.loadPage(a.page),this.canvas.apply(a.ids,s?a.oldObjects:a.newObjects),t.push(a),this.locked=!1,this.canvas.modified=!0,this.updateState()}}}class ee{constructor(e,t,s,a,i,n){this.canvas=e,this.pages=t,this.files=s,this.history=a,this.canvasWidth=i,this.canvasHeight=n,this.copy=async()=>{const e=this.canvas.getActiveObject();return e?(e.clone(e=>{this.clipboard=e}),e):null},this.cut=async()=>{const e=await this.copy();return!!e&&(this.canvas.discardActiveObject(),"activeSelection"===e.type?(e.forEachObject(e=>{this.canvas.remove(e)}),await this.history.remove(e._objects)):(this.canvas.remove(e),await this.history.remove([e])),this.canvas.requestRenderAll(),!0)},this.paste=async()=>{if(this.clipboard)return this.clipboard.clone(e=>this.canvas.placeObject(e).then(this.history.add))},this.pasteExternal=async e=>{const t=await this.files.processFiles(e.clipboardData.files);await this.history.execute(t),await this.paste()},window.addEventListener("paste",this.pasteExternal)}}const te=[[0,0],[20,15],[5,10]];class se{constructor(e,t,s,a){this.currentStyle=e,this.drawerOptions=t,this.freeDrawingBrush=s,this.updateState=a,this.set=(e,t,s)=>{if(null!==e&&(this.currentStyle.dash=e,this.drawerOptions.strokeDashArray=te[e],this.freeDrawingBrush.strokeDashArray=te[e]),null!==t&&(this.currentStyle.stroke=t,this.drawerOptions.stroke=t,this.freeDrawingBrush.color=t),null!==s&&(this.currentStyle.fill=s),null!==t||null!==s)switch(this.currentStyle.fill){case 0:this.drawerOptions.fill="transparent";break;case 1:this.drawerOptions.fill=this.currentStyle.stroke;break;case 2:this.drawerOptions.fill=this.currentStyle.stroke+"11"}this.updateState()}}}class ae extends Error{constructor(e){super(e),this.name=this.constructor.name}}class ie extends ae{constructor(e,t){super(t),this.code=e}}class ne extends ie{constructor(e=400,t="HTTP Error"){super(e,t)}}class ce extends ne{constructor(e=404,t="Resource not found"){super(e,t)}}class le{static async loadJSON(e){return(await le.fetch(e,e=>{e.overrideMimeType("application/json"),e.responseType="json"})).response}static async fetch(e,t=(()=>{}),s="GET",a=null,i=(e=>e>=200&&e<300)){const n=new XMLHttpRequest;return n.open(s,e,!0),t(n),n.send(a),new Promise((e,t)=>{n.onreadystatechange=function(){4===n.readyState&&(i(n.status)?e(n):t(new ce(n.status,n.statusText)))}})}}s(39);var re=new class{constructor(e,t,s,a){this.canvasElement=e,this.baseCanvasElement=t,this.canvasWidth=s,this.canvasHeight=a,this.handlers=U,this.currentStyle={dash:0,stroke:"#000000",fill:0},this.drawerOptions={fill:"transparent",stroke:"#000000",strokeWidth:4,selectable:!1,strokeDashArray:[0,0],strokeUniform:!0},this.dragActive=!1,this.isDown=!1,this.strict=!1,this.updateState=()=>{var e;null===(e=null==this?void 0:this.callback)||void 0===e||e.call(this,{dragActive:this.dragActive,currentPage:this.pages.currentIndex+1,totalPages:this.pages.pagesJSON.length,currentTool:this.currentTool,currentStyle:this.currentStyle,canUndo:this.history.history.length>0,canRedo:this.history.redoStack.length>0,keyMap:this.keyboard.keyMap})},this.switchTool=async e=>{var t,s;2===e&&await this.clipboard.cut()||(this.currentTool=e,this.tool=this.handlers[e],0===e||this.tool.isBrush?(await this.baseCanvas.activateSelection(),this.canvasElement.parentElement.style.display="none",await(null===(s=(t=this.tool).setBrush)||void 0===s?void 0:s.call(t,this.baseCanvas.freeDrawingBrush,this.drawerOptions))):(await this.baseCanvas.deactivateSelection(),this.canvasElement.parentElement.style.display="block"),this.baseCanvas.isDrawingMode=this.tool.isBrush,this.updateState())},this.windowResize=async()=>{clearTimeout(this.resizeCooldown),this.resizeCooldown=setTimeout(async()=>{await this.canvas.fitToWindow(this.canvasWidth,this.canvasHeight),await this.baseCanvas.fitToWindow(this.canvasWidth,this.canvasHeight)},100)},this.mouseDown=async e=>{if(!this.tool.draw)return;const{x:t,y:s}=this.canvas.getPointer(e.e);this.isDown=!0,this.currentObject=await this.tool.draw(t,s,this.drawerOptions),this.currentObject.id=await this.baseCanvas.getNextId(),this.canvas.add(this.currentObject),this.canvas.requestRenderAll()},this.mouseMove=async e=>{if(!this.tool.draw||!this.isDown)return;const{x:t,y:s}=this.canvas.getPointer(e.e);await this.tool.resize(this.currentObject,t,s,this.strict),this.canvas.requestRenderAll()},this.mouseUp=async()=>{this.tool.draw&&(this.isDown=!1,this.baseCanvas.add(h.fabric.util.object.clone(this.currentObject)),this.baseCanvas.requestRenderAll(),this.canvas.remove(this.currentObject),this.canvas.requestRenderAll(),await this.history.add([this.currentObject]))},this.setDragActive=e=>{this.dragActive=e,this.updateState()},this.drop=async e=>{e.e.stopPropagation(),e.e.preventDefault(),this.updateCursor(e),this.setDragActive(!1);const t=await this.files.processFiles(e.e.dataTransfer.files);await this.history.execute(t)},this.pathCreated=async e=>{if(1===this.currentTool)e.path.id=await this.baseCanvas.getNextId(),await this.history.add([e.path]);else if(2===this.currentTool){const t=h.fabric.util.object.clone(e.path);this.baseCanvas.remove(e.path);const s=this.baseCanvas.getObjects().filter(e=>e.intersectsWithObject(t));if(!s.length)return;this.baseCanvas.remove(...s),await this.history.remove(s)}else 3===this.currentTool&&setTimeout(async()=>{this.baseCanvas.remove(e.path),this.baseCanvas.requestRenderAll()},1e3)},this.selectionCreated=e=>!this.history.locked&&this.history.store(e.selected),this.objectModified=async e=>{await this.history.modify(e.target._objects||[e.target]),await this.history.store(e.target._objects||[e.target])},this.updateCursor=e=>{const{x:t,y:s}=this.baseCanvas.getPointer(e.e);this.baseCanvas.cursor={x:t,y:s}};const i=new URLSearchParams(window.location.search);this.baseCanvas=new L(t,{backgroundColor:"white",renderOnAddRemove:!1,selection:!1,targetFindTolerance:15}),this.canvas=new L(e,{renderOnAddRemove:!1,selection:!1}),this.pages=new V(this.baseCanvas,this.canvasWidth,this.canvasHeight,this.updateState),null!==i.get("json")&&le.loadJSON(i.get("json")).then(G.readParsed).then(this.pages.overwritePages).catch(console.error),this.files=new _(this.pages),this.history=new K(this.baseCanvas,this.pages,this.updateState),this.clipboard=new ee(this.baseCanvas,this.pages,this.files,this.history,this.canvasWidth,this.canvasHeight),this.style=new se(this.currentStyle,this.drawerOptions,this.baseCanvas.freeDrawingBrush,this.updateState),this.action=new m(this.switchTool,this.currentStyle,this.pages,this.files,this.history,this.clipboard,this.style.set),this.keyboard=new b(this.action.doAction,e=>this.strict=e,this.updateState),this.switchTool(0),this.windowResize(),window.onresize=this.windowResize,window.onbeforeunload=()=>this.baseCanvas.modified||null,this.canvas.on("mouse:down",this.mouseDown),this.canvas.on("mouse:move",this.mouseMove),this.canvas.on("mouse:up",this.mouseUp),this.baseCanvas.on("dragenter",()=>this.setDragActive(!0)),this.baseCanvas.on("dragleave",()=>this.setDragActive(!1)),this.baseCanvas.on("drop",this.drop),this.baseCanvas.on("path:created",this.pathCreated),this.baseCanvas.on("selection:created",this.selectionCreated),this.baseCanvas.on("object:modified",this.objectModified),this.baseCanvas.on("mouse:move",this.updateCursor)}}(document.querySelector("#QBoard"),document.querySelector("#BaseQBoard"),1600,900);l.a.render(n.a.createElement(q,{qboard:re}),document.querySelector("#Overlay"))}},[[40,1,2]]]);
//# sourceMappingURL=main.13ec2773.js.map