(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{26:function(e,t){},27:function(e,t){},28:function(e,t){},51:function(e,t,s){},52:function(e,t,s){"use strict";s.r(t);var a=s(0),i=s.n(a),n=s(9),r=s.n(n),l=s(4),c=s.n(l),o=s(2);var h,d=s(5);class u extends d.MalformedExpressionException{constructor(e,t,s){super(void 0===t?e:`${e}\n\nin LaTeX ${t}`),this.errorText=e,this.sourceTeX=t,this.node=s}}function p(e){var t,s;const a=(new window.DOMParser).parseFromString(e,"image/svg+xml").querySelector('[data-mml-node="merror"]');if(null===a)return null;return{errorText:a.getAttribute("title"),sourceText:null!==(s=null===(t=a.querySelector('[data-mml-node="mtext"] text'))||void 0===t?void 0:t.textContent)&&void 0!==s?s:void 0,MathJaxErrorNode:a}}!function(e){e.PreviousPage="previousPage",e.NextPage="nextPage",e.AddPageStart="addPageStart",e.AddPageEnd="addPageEnd",e.Undo="undo",e.Redo="redo",e.Open="open",e.Save="save",e.Export="export",e.Cut="cut",e.Copy="copy",e.Paste="paste",e.Deselect="deselect",e.SelectAll="selectAll",e.Duplicate="duplicate",e.Move="move",e.Pen="pen",e.Eraser="eraser",e.Laser="laser",e.Line="line",e.Ellipse="ellipse",e.Rectangle="rectangle",e.LaTeX="latex",e.Dotted="dotted",e.Dashed="dashed",e.Solid="solid",e.Black="black",e.Blue="blue",e.Green="green",e.Orange="orange",e.Yellow="yellow",e.Transparent="transparent",e.HalfFilled="halfFilled",e.Filled="filled",e.Help="help",e.ResetStyles="resetStyles",e.FullScreen="fullScreen",e.EnterFullScreen="enterFullScreen",e.ExitFullScreen="exitFullScreen"}(h||(h={}));const v={previousPage:"–Page",nextPage:"+Page",addPageStart:"-Page",addPageEnd:"+Page",selectAll:"Select All",duplicate:"Clone",eraser:"Cut / Eraser",rectangle:"Rect.",latex:"LaTeX",transparent:"Unfilled",halfFilled:"Half Fill",resetStyles:"Reset Styles",fullScreen:"Full Screen",enterFullScreen:"Enter Full Screen",exitFullScreen:"Exit Full Screen"},m=e=>{var t;const s=null!==(t=v[e])&&void 0!==t?t:e;return s[0].toUpperCase()+s.slice(1)};class g{constructor(e,t,s,a,i,n,r,l,c){this.switchTool=e,this.currentStyle=s,this.pages=a,this.files=i,this.history=n,this.clipboard=r,this.setStyle=l,this.globalState=c,this.doAction=e=>this.actionMap[e](),this.setDash=e=>{e===this.currentStyle.dash?this.setStyle(0,null,null):this.setStyle(e,null,null)},this.setStroke=e=>{e===this.currentStyle.stroke?this.setStyle(null,"#000000",null):this.setStyle(null,e,null)},this.setFill=e=>{e===this.currentStyle.fill?this.setStyle(null,null,0):this.setStyle(null,null,e)},this.requestTeX=async()=>{const e=window.prompt("Enter LaTeX source");if(null===e)return"no latex entered";let t;try{t=function e(t){let s=e(`\\text{${t}}`),a=p(s);if((null==a?void 0:a.errorText.endsWith("allowed only in math mode"))&&(s=e(t),null===p(s)&&(a=null)),null!==a)throw new u(a.errorText,a.sourceText,a.MathJaxErrorNode);return"data:image/svg+xml,"+encodeURIComponent(s)}(e)}catch(e){return console.error(e,e.node),window.alert(`Error in LaTeX: ${e.errorText}\n\nMore details printed to console.`),"invalid latex"}const s=await this.canvas.addImage(t,{},{scaleX:3,scaleY:3});return this.history.add([s]),await this.history.undo(),await this.history.redo(),"success"},this.canvas=this.pages.canvas,this.actionMap={previousPage:a.previousOrNewPage,nextPage:a.nextOrNewPage,addPageStart:a.previousOrNewPage,addPageEnd:a.nextOrNewPage,undo:n.undo,redo:n.redo,open:()=>{var e,t;return null===(t=null===(e=c.fileInputRef)||void 0===e?void 0:e.current)||void 0===t?void 0:t.click()},save:a.saveFile,export:a.export,cut:r.cut,copy:r.copy,paste:r.paste,deselect:()=>{this.canvas.discardActiveObject(),this.canvas.requestRenderAll()},selectAll:()=>{this.canvas.discardActiveObject(),this.canvas.setActiveObject(new o.fabric.ActiveSelection(this.canvas.getObjects(),{canvas:this.canvas})),this.canvas.requestRenderAll()},duplicate:()=>{this.clipboard.copy(),this.clipboard.paste()},move:()=>this.switchTool(t.Move),pen:()=>this.switchTool(t.Pen),eraser:()=>this.switchTool(t.Eraser),laser:()=>this.switchTool(t.Laser),line:()=>this.switchTool(t.Line),ellipse:()=>this.switchTool(t.Ellipse),rectangle:()=>this.switchTool(t.Rectangle),latex:this.requestTeX,dotted:()=>this.setDash(2),dashed:()=>this.setDash(1),solid:()=>this.setDash(0),blue:()=>this.setStroke("#0097f6"),green:()=>this.setStroke("#00b253"),yellow:()=>this.setStroke("#ffbf00"),orange:()=>this.setStroke("#ff2600"),black:()=>this.setStroke("#000000"),transparent:()=>this.setFill(0),halfFilled:()=>this.setFill(2),filled:()=>this.setFill(1),resetStyles:()=>this.setStyle(0,"#000000",0),help:()=>{var e;return null===(e=c.toggleHelpModal)||void 0===e?void 0:e.call(c)},fullScreen:()=>this.doAction(document.fullscreenElement?h.ExitFullScreen:h.EnterFullScreen),enterFullScreen:()=>document.documentElement.requestFullscreen(),exitFullScreen:()=>document.exitFullscreen()}}}const b={q:h.Laser,w:h.Copy,e:h.Blue,esc:h.Deselect,r:h.Green,a:h.PreviousPage,s:h.NextPage,d:h.Pen,f:h.Undo,g:h.Paste,z:h.ResetStyles,x:h.Eraser,c:h.Line,v:h.Move,"shift + q":h.Dotted,"shift + w":h.Transparent,"shift + e":h.Ellipse,"shift + r":h.Rectangle,"shift + a":h.Dashed,"shift + s":h.HalfFilled,"shift + d":h.Black,"shift + f":h.Redo,"shift + z":h.Solid,"shift + x":h.Filled,"shift + c":h.Yellow,"shift + v":h.Orange,"ctrl + a":h.SelectAll,"ctrl + s":h.Save,"ctrl + d":h.Duplicate,"ctrl + z":h.Undo,"ctrl + x":h.Cut,"ctrl + c":h.Copy,1:h.Help,0:h.Help,"/":h.Help,"shift + /":h.Help};class y{constructor(e,t,s){this.doAction=e,this.setStrict=t,this.updateState=s,this.keyMap={},this.save=()=>{window.localStorage.setItem("keyMap",JSON.stringify(this.keyMap))},this.clear=()=>{window.localStorage.removeItem("keyMap")},this.bindAll=(e=!1)=>{for(const[t,s]of Object.entries(this.keyMap))this.bind(t,s,e);this.updateState()},this.unbind=e=>{delete this.keyMap[e],c.a.unbind(e),this.updateState(),this.save()},this.bind=(e,t,s=!0)=>{this.keyMap[e]=t,c.a.bind(e,()=>this.doAction(this.keyMap[e])),this.updateState(),s&&this.save()},this.reset=()=>{for(const e of Object.keys(this.keyMap))c.a.unbind(e);this.keyMap={...b},this.bindAll(),this.clear()},c.a.bind("shift",()=>{this.setStrict(!0)},()=>{this.setStrict(!1)});const a=window.localStorage.getItem("keyMap");null===a?this.reset():(this.keyMap=JSON.parse(a),this.bindAll(),Object.values(this.keyMap).every(e=>e!==h.Help)&&(this.bind("0",h.Help),this.bind("1",h.Help),this.bind("/",h.Help),this.bind("shift + /",h.Help)))}}var f=s(17);const w=(e,t)=>i.a.createElement("i",{className:"fas fa-"+e,style:t});var S={close:w("times-circle"),previousPage:w("caret-left"),nextPage:w("caret-right"),addPageStart:w("plus",{transform:"scale(0.7)"}),addPageEnd:w("plus",{transform:"scale(0.7)"}),undo:w("undo"),redo:w("redo"),move:w("mouse-pointer"),pen:w("pen"),eraser:w("eraser"),laser:w("asterisk"),line:w("minus",{transform:"rotate(-45deg)"}),ellipse:w("circle"),rectangle:w("square"),latex:w("font"),file:w("file"),open:w("folder-open"),save:w("save"),export:w("file-export"),cut:w("cut"),copy:w("copy"),paste:w("paste"),duplicate:w("clone"),help:w("question"),fullScreen:w("expand"),enterFullScreen:w("expand"),exitFullScreen:w("compress"),black:w("circle",{color:"#000000"}),blue:w("circle",{color:"#0097f6"}),green:w("circle",{color:"#00b253"}),orange:w("circle",{color:"#ff2600"}),yellow:w("circle",{color:"#ffbf00"}),dotted:i.a.createElement("svg",{viewBox:"0 0 21 21",style:{width:"1em",height:"1.1em"}},i.a.createElement("g",{transform:"translate(-90 -1158)"},i.a.createElement("g",null,i.a.createElement("path",{d:"M104.184,1164.401l1.43-1.43c-1.294-1.035-2.878-1.721-4.613-1.913v2.021    C102.184,1163.25,103.27,1163.716,104.184,1164.401z"}),i.a.createElement("path",{d:"M95.816,1175.599l-1.43,1.43c1.294,1.035,2.878,1.721,4.613,1.913v-2.021C97.816,1176.75,96.73,1176.284,95.816,1175.599z"}),i.a.createElement("path",{d:"M94.401,1165.815l-1.429-1.43c-1.036,1.295-1.723,2.879-1.914,4.614h2.021    C93.25,1167.817,93.716,1166.731,94.401,1165.815z"}),i.a.createElement("path",{d:"M106.92,1171c-0.17,1.183-0.636,2.269-1.322,3.185l1.43,1.43c1.036-1.295,1.723-2.879,1.914-4.614H106.92z"})))),dashed:i.a.createElement("svg",{viewBox:"0 0 21 21",style:{width:"1em",height:"1.1em"}},i.a.createElement("g",{transform:"translate(-90 -1158)"},i.a.createElement("g",null,i.a.createElement("path",{d:"M101,1176.92v2.021c1.735-0.192,3.319-0.878,4.613-1.913l-1.43-1.43C103.269,1176.284,102.183,1176.75,101,1176.92z"}),i.a.createElement("path",{d:"M93.08,1171h-2.021c0.191,1.735,0.879,3.319,1.914,4.614l1.43-1.43C93.716,1173.269,93.25,1172.183,93.08,1171z"}),i.a.createElement("path",{d:"M104.184,1164.401l1.43-1.43c-1.294-1.035-2.878-1.721-4.613-1.913v2.021    C102.184,1163.25,103.27,1163.716,104.184,1164.401z"}),i.a.createElement("path",{d:"M106.92,1169h2.021c-0.191-1.735-0.879-3.319-1.914-4.614l-1.43,1.43C106.284,1166.731,106.75,1167.817,106.92,1169z"}),i.a.createElement("path",{d:"M95.816,1175.599l-1.43,1.43c1.294,1.035,2.878,1.721,4.613,1.913v-2.021C97.816,1176.75,96.73,1176.284,95.816,1175.599z"}),i.a.createElement("path",{d:"M94.401,1165.815l-1.429-1.43c-1.036,1.295-1.723,2.879-1.914,4.614h2.021    C93.25,1167.817,93.716,1166.731,94.401,1165.815z"}),i.a.createElement("path",{d:"M99,1163.08v-2.021c-1.735,0.192-3.319,0.878-4.613,1.913l1.43,1.43C96.731,1163.716,97.817,1163.25,99,1163.08z"}),i.a.createElement("path",{d:"M106.92,1171c-0.17,1.183-0.636,2.269-1.322,3.185l1.43,1.43c1.036-1.295,1.723-2.879,1.914-4.614H106.92z"})))),solid:i.a.createElement("i",{className:"far fa-circle"}),transparent:i.a.createElement("i",{className:"far fa-circle"}),halfFilled:i.a.createElement("div",{style:{height:"0.7em",marginRight:"1em",position:"relative"}},i.a.createElement("i",{className:"fas fa-circle",style:{left:"50%",opacity:.3,position:"absolute",top:0}}),i.a.createElement("i",{className:"far fa-circle",style:{left:"50%",position:"absolute",top:0}})),filled:w("circle"),deselect:w("object-ungroup"),resetStyles:w("remove-format"),selectAll:w("object-group")};var E=e=>i.a.createElement(i.a.Fragment,null,i.a.createElement("button",{className:e.className,"data-tip":!0,"data-for":e.action,onClick:()=>e.callback(e.action)},S[e.action]),i.a.createElement(f.a,{backgroundColor:"#ddd",effect:"solid",id:e.action,place:"right",textColor:"#262626"},m(e.action)));var k=e=>{const[t,s]=Object(a.useState)(0),[n,r]=Object(a.useState)("0.6em");Object(a.useEffect)(()=>{s(e.currentPage),r(.6*e.currentPage.toString().length+"em")},[e]);const l=async()=>{if(!t)return;const a=Number(t);!a||a>e.totalPages?s(e.currentPage):await e.loadPage(a-1)};Object(a.useEffect)(()=>{l()},[t]);return i.a.createElement("div",{className:"pagination visibility-"+e.visibility},i.a.createElement(E,{action:1===e.currentPage?h.AddPageStart:h.PreviousPage,callback:e.doAction}),i.a.createElement("form",{onSubmit:e=>(null==e||e.preventDefault(),l())},i.a.createElement("input",{onChange:e=>s(e.target.value),type:"text",value:t,style:{width:n},tabIndex:-1})),i.a.createElement("span",{className:"total-pages"}," / ",e.totalPages),i.a.createElement(E,{action:e.currentPage===e.totalPages?h.AddPageEnd:h.NextPage,callback:e.doAction}))};var O=e=>i.a.createElement("div",{className:"undoredo visibility-"+e.visibility},i.a.createElement(E,{action:h.Undo,callback:e.doAction,className:e.canUndo?void 0:"disabled"}),i.a.createElement(E,{action:h.Redo,callback:e.doAction,className:e.canRedo?void 0:"disabled"}));var x=e=>{const t=[{tool:e.tools.Move,action:h.Move},{tool:e.tools.Pen,action:h.Pen},{tool:e.tools.Eraser,action:h.Eraser},{tool:e.tools.Laser,action:h.Laser},{tool:e.tools.Line,action:h.Line},{tool:e.tools.Rectangle,action:h.Rectangle},{tool:e.tools.Ellipse,action:h.Ellipse}];return i.a.createElement("div",{className:"toolbar visibility-"+e.visibility},t.map(({tool:t,action:s})=>i.a.createElement(E,{action:s,callback:e.doAction,className:t.isActive()?"active":void 0,key:s})),i.a.createElement(E,{action:h.LaTeX,callback:e.doAction}))};var A=e=>i.a.createElement("div",{className:`button-row ${e.cName} ${e.outerButton?"button-row-hover":""}`},e.outerButton,i.a.createElement("div",{className:"button-row-inner"},e.actions.map((t,s)=>{var a;return i.a.createElement(E,{action:t,className:null===(a=e.className)||void 0===a?void 0:a.call(e,t,s),callback:e.callback,key:t})})));const P=({dashStyle:e,callback:t,inContext:s=!1})=>{const a=[h.Solid,h.Dashed,h.Dotted],n=i.a.createElement("button",{className:"inactive"},S[a[e]]);return i.a.createElement(A,{actions:a,className:(t,a)=>{if(s&&e===a)return"active"},callback:t,outerButton:!s&&n})},C=({strokeStyle:e,callback:t,inContext:s=!1})=>{const a=[h.Black,h.Blue,h.Green,h.Yellow,h.Orange],n=["#000000","#0097f6","#00b253","#ffbf00","#ff2600"],r=i.a.createElement("button",{className:"inactive"},i.a.createElement("i",{className:"fas fa-circle",style:{color:e}}));return i.a.createElement(A,{actions:a,className:(t,a)=>{if(s&&e===n[a])return"active"},callback:t,outerButton:!s&&r})},N=({fillStyle:e,callback:t,inContext:s=!1})=>{const a=[h.Transparent,h.Filled,h.HalfFilled],n=i.a.createElement("button",{className:"inactive"},S[a[e]]);return i.a.createElement(A,{actions:a,className:(t,a)=>{if(s&&e===a)return"active"},callback:t,outerButton:!s&&n})};var j=e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(P,{dashStyle:e.currentStyle.dash,callback:e.doAction,inContext:e.inContext}),i.a.createElement(C,{strokeStyle:e.currentStyle.stroke,callback:e.doAction,inContext:e.inContext}),i.a.createElement(N,{fillStyle:e.currentStyle.fill,callback:e.doAction,inContext:e.inContext}));var M=e=>{const t=i.a.createElement("button",{className:"inactive"},S.file),s=[h.Open,h.Save,h.Export],[n,r]=Object(a.useState)(!1),l=[h.Copy,h.Paste,h.Help,n?h.ExitFullScreen:h.EnterFullScreen];return Object(a.useEffect)(()=>{r(Boolean(document.fullscreenElement)),document.addEventListener("fullscreenchange",()=>r(Boolean(document.fullscreenElement)))},[]),i.a.createElement("div",{className:"stylebar visibility-"+e.visibility},i.a.createElement(A,{actions:s,callback:e.doAction,cName:"file-actions",outerButton:t}),i.a.createElement(j,{currentStyle:e.currentStyle,doAction:e.doAction}),i.a.createElement(A,{actions:l,cName:"other-actions vertical",callback:e.doAction}))},F=s(3),T=s.n(F);T.a.setAppElement("#Overlay");const D=[h.AddPageStart,h.AddPageEnd,h.EnterFullScreen,h.ExitFullScreen];var R=e=>i.a.createElement(T.a,{className:"modal",overlayClassName:"modal-overlay binding-modal",isOpen:""!==e.letter},i.a.createElement("button",{className:"close",onClick:()=>e.close()},S.close),i.a.createElement("p",null,"Changing ",i.a.createElement("span",{className:"binding"},e.letter)," binding…"),i.a.createElement("div",{className:"tools"},i.a.createElement("button",{className:void 0===e.action?"active":void 0,onClick:()=>e.callback(null)},i.a.createElement("span",{style:{left:"0.25em"}},"none")),Object.values(h).filter(e=>!D.includes(e)).map(t=>i.a.createElement("button",{key:t,className:e.action===t?"active":void 0,onClick:()=>e.callback(t)},S[t],i.a.createElement("span",{style:S[t]?{}:{left:"0.25em"}},m(t))))));const B=({label:e="",letter:t,width:s})=>i.a.createElement("div",{className:"key",style:{width:s}},i.a.createElement("span",{className:"letter"},t),i.a.createElement("div",{className:"action"},i.a.createElement("span",{className:"unassigned"},e))),q=e=>{const[t,s]=Object(a.useState)(!1);return i.a.createElement("button",{className:"key modifier "+(t?"held":""),onClick:()=>{t?e.set.delete(e.letter):e.set.add(e.letter),e.replaceSet(new Set(e.set)),s(!t)},style:{width:e.width}},i.a.createElement("div",{className:"action"},i.a.createElement("span",{className:"unassigned"},e.label)),i.a.createElement("span",{className:"letter"},e.letter))},I=e=>i.a.createElement("button",{className:"key",onClick:t=>e.onclick(e.letter,t),style:{width:e.width}},i.a.createElement("div",{className:"action"},e.action&&S[e.action],i.a.createElement("span",{className:void 0===e.action?"unassigned":void 0},void 0===e.action?"none":m(e.action))),i.a.createElement("span",{className:"letter"},e.letter)),L=({rows:e,onclick:t,activeModifiers:s,setActiveModifiers:a,...n})=>i.a.createElement("div",Object.assign({},n),e.map((e,n)=>i.a.createElement("div",{className:"row",key:n},e.map(e=>"readonly"===e.type?i.a.createElement(B,{key:e.key,letter:e.key,label:e.value,width:e.width}):"modifier"===e.type?i.a.createElement(q,{key:e.key,letter:e.key,label:e.value,set:s,replaceSet:a,width:e.width}):i.a.createElement(I,{key:e.key,letter:e.key,action:e.action,width:e.width,onclick:(e,s)=>t(e,s)})))));T.a.setAppElement("#Overlay");var z=e=>{const[t,s]=Object(a.useState)(""),[n,r]=Object(a.useState)(null),[l,c]=Object(a.useState)(new Set),o=e=>[...Array.from(l).sort(),e].join(" + "),h=t=>({key:t,action:e.keyMap[o(t)]}),d=(...e)=>e.map(h),u=[[{...h("`"),width:"3em"},...d("1","2","3","4","5","6","7","8","9","0")],[{type:"readonly",key:"tab",value:"Hide Toolbar",width:"4.5em"},...d("q","w","e","r","t","y","u","i","o","p")],[{...h("esc"),width:"6em"},...d("a","s","d","f","g","h","j","k","l",";")],[{type:"modifier",key:"shift",value:"Snap",width:"7.5em"},...d("z","x","c","v","b","n","m","/"),{type:"modifier",key:"ctrl"},{type:"modifier",key:"alt"}]];return i.a.createElement(i.a.Fragment,null,i.a.createElement(L,{rows:u,className:"bindings",onclick:t=>{const a=o(t);s(a),r(e.keyMap[a])},activeModifiers:l,setActiveModifiers:c}),i.a.createElement(R,{letter:t,action:n,close:()=>s(""),callback:a=>{e.unbind(t),a&&e.bind(t,a),s("")}}))};T.a.setAppElement("#Overlay");var U=e=>i.a.createElement(T.a,{className:"modal",overlayClassName:"modal-overlay help-modal",isOpen:e.isOpen},i.a.createElement("button",{className:"close",onClick:()=>e.toggleOpen()},S.close),i.a.createElement("p",null,i.a.createElement("span",{style:{fontSize:"1.5em",fontWeight:"bold"}},"qboard"),i.a.createElement("span",{style:{color:"#666",marginLeft:"0.5em"}},"The efficient digital whiteboard."),i.a.createElement("span",{style:{color:"#000",marginLeft:"0.5em"}},"Press ",i.a.createElement("b",null,"?")," to show or hide this screen.")),i.a.createElement(z,{bind:e.bind,unbind:e.unbind,keyMap:e.keyMap}),i.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},i.a.createElement("p",null,"Click a key to change the binding."," ",i.a.createElement("button",{onClick:()=>e.reset()},"reset to default")),i.a.createElement("p",{style:{color:"#666"}},"By ",i.a.createElement("a",{href:"https://cjquines.com/"},"CJ Quines")," and"," ",i.a.createElement("a",{href:"https://pihart.github.io/"},"Avi Mehra"),". View on"," ",i.a.createElement("a",{href:"https://github.com/cjquines/qboard"},"Github"),".")));var H=e=>{const[t,s]=Object(a.useState)(null);return Object(a.useEffect)(()=>{document.addEventListener("contextmenu",e=>{e.target.classList.contains("upper-canvas")&&(e.preventDefault(),e.stopPropagation(),s(t=>t?null:[e.clientX,e.clientY]))}),document.addEventListener("click",()=>s(null))},[]),t?i.a.createElement("div",{className:"context-menu",style:{top:`calc(${t[1]}px - 2.8em)`,left:`calc(${t[0]}px - 1.1em)`}},i.a.createElement(j,{currentStyle:e.currentStyle,doAction:t=>e.doAction(t),inContext:!0})):null};var J=({acceptFiles:e,captureRef:t,...s})=>{const n=Object(a.useRef)(null);return null==t||t(n),i.a.createElement("input",Object.assign({onChange:void 0===e?void 0:t=>{var s;(null===(s=t.target.files)||void 0===s?void 0:s.length)&&e(t.target.files)},ref:n,type:"file",style:{display:"none"}},s))};var W=({qboard:e})=>{const[t,s]=Object(a.useState)(2),[n,r]=Object(a.useState)(!1),[l,o]=Object(a.useState)({dragActive:!1,currentPage:0,totalPages:0,currentStyle:{dash:0,stroke:"#000000",fill:0},canUndo:!1,canRedo:!1,keyMap:b}),h=()=>{r(e=>(window.localStorage.setItem("helpModalOpen",e?"false":"true"),!e))};return Object(a.useEffect)(()=>{"false"!==window.localStorage.getItem("helpModalOpen")&&r(!0),e.callback=o,e.globalState.toggleHelpModal=h,e.updateState(),c.a.bind("tab",()=>{s(e=>(e+2)%3)})},[]),i.a.createElement(i.a.Fragment,null,i.a.createElement(J,{acceptFiles:e.files.acceptFile,captureRef:t=>{e.globalState.fileInputRef=t},accept:"application/json, application/pdf, image/*"}),i.a.createElement("div",{className:"drop-area "+(l.dragActive?"active":"")}),i.a.createElement("div",{className:"overlay visibility-"+t},i.a.createElement(k,{loadPage:e.pages.loadPage,currentPage:l.currentPage,totalPages:l.totalPages,doAction:e.action.doAction,visibility:t}),i.a.createElement(O,{canUndo:l.canUndo,canRedo:l.canRedo,doAction:e.action.doAction,visibility:t}),i.a.createElement(x,{currentTool:e.activeTool,tools:e.tools,doAction:e.action.doAction,visibility:t}),i.a.createElement(M,{currentStyle:l.currentStyle,doAction:e.action.doAction,visibility:t,isMobile:!0}),i.a.createElement(U,{bind:e.keyboard.bind,unbind:e.keyboard.unbind,reset:e.keyboard.reset,keyMap:l.keyMap,isOpen:n,toggleOpen:h,isMobile:!0})),i.a.createElement(H,{currentStyle:l.currentStyle,doAction:e.action.doAction}))};class X{}X.rectify=(e,t,s,a,i)=>e.map(e=>X.project(t,s,e[0],e[1],a,i)).reduce((e,t)=>e[0]<t[0]?e:t),X.project=(e,t,s,a,i,n)=>{const r=i-e,l=n-t,c=s*l-a*r,o=s*s+a*a;return[Math.abs(c)/o,e+r+a*c/o,t+l-s*c/o]};class _{constructor(e,t,s){this.baseCanvas=e,this.history=t,this.clipboard=s,this._isDrawing=!1,this._requiresBase=!1,this._isBrush=!1,this.active=!1,this.activate=()=>this.setActive(!0),this.deactivate=()=>this.setActive(!1),this.isActive=()=>this.active,this.setActive=e=>this.active=e}isDrawing(){return this._isDrawing}requiresBase(){return this._requiresBase}isBrush(){return this._isBrush}}class $ extends _{constructor(){super(...arguments),this._isDrawing=!0}}class Y extends _{constructor(){super(...arguments),this._requiresBase=!0}}class G extends Y{constructor(){super(...arguments),this._isBrush=!0,this.pathCreated=()=>{},this.setBrush=()=>{}}}class Q extends Y{}class Z extends G{constructor(){super(...arguments),this.pathCreated=e=>{e.path.id=this.baseCanvas.getNextId(),this.history.add([e.path])},this.setBrush=(e,t)=>{e.color=t.stroke,e.strokeDashArray=t.strokeDashArray,e.width=t.strokeWidth}}}class V extends G{constructor(){super(...arguments),this.pathCreated=e=>{const t=o.fabric.util.object.clone(e.path);this.baseCanvas.remove(e.path);const s=this.baseCanvas.getObjects().filter(e=>e.intersectsWithObject(t));s.length&&(this.baseCanvas.remove(...s),this.history.remove(s))},this.setBrush=(e,t)=>{e.color="#ff005455",e.strokeDashArray=[0,0],e.width=5*t.strokeWidth},this.activate=()=>!this.clipboard.cut()&&this.setActive(!0)}}class K extends G{constructor(){super(...arguments),this.pathCreated=e=>{setTimeout(()=>{this.baseCanvas.remove(e.path),this.baseCanvas.requestRenderAll()},1e3)},this.setBrush=(e,t)=>{e.color="#f23523",e.strokeDashArray=[0,0],e.width=t.strokeWidth}}}class ee extends ${constructor(){super(...arguments),this.x=0,this.y=0,this.dirs=[[1,0],[1,1],[0,1],[-1,1]],this.draw=(e,t,s,a,i)=>(this.x=e,this.y=t,new o.fabric.Line([e,t,a,i],{...s,perPixelTargetFind:!0})),this.resize=(e,t,s,a)=>{const[,i,n]=a?X.rectify(this.dirs,this.x,this.y,t,s):[void 0,t,s];return e.set({x2:i,y2:n}).setCoords(),e}}}class te extends ${constructor(){super(...arguments),this.x=0,this.y=0,this.dirs=[[1,1],[-1,1]],this.draw=(e,t,s,a,i)=>(this.x=e,this.y=t,new o.fabric.Rect({left:e,top:t,width:a,height:i,...s})),this.resize=(e,t,s,a)=>{const[,i,n]=a?X.rectify(this.dirs,this.x,this.y,t,s):[void 0,t,s];return e.set({originX:this.x>i?"right":"left",originY:this.y>n?"bottom":"top",width:Math.abs(this.x-i),height:Math.abs(this.y-n)}).setCoords(),e}}}class se extends ${constructor(){super(...arguments),this.x=0,this.y=0,this.dirs=[[1,1],[-1,1]],this.draw=(e,t,s,a,i)=>(this.x=e,this.y=t,new o.fabric.Ellipse({...s,left:e,top:t,rx:a,ry:i})),this.resize=(e,t,s,a)=>{const[,i,n]=a?X.rectify(this.dirs,this.x,this.y,t,s):[void 0,t,s];return e.set({originX:this.x>i?"right":"left",originY:this.y>n?"bottom":"top",rx:Math.abs(i-(e.left||0))/2,ry:Math.abs(n-(e.top||0))/2}).setCoords(),e}}}var ae=(e,t,s)=>({Move:new Q(e,t,s),Pen:new Z(e,t,s),Eraser:new V(e,t,s),Laser:new K(e,t,s),Line:new ee(e,t,s),Rectangle:new te(e,t,s),Ellipse:new se(e,t,s)});function ie(e){return"_objects"in e}class ne extends o.fabric.Canvas{constructor(){super(...arguments),this.latestId=0,this.modified=!1,this.fitToWindow=(e,t)=>{const s=window.innerWidth/e,a=window.innerHeight/t;this.setZoom(Math.min(s,a)),this.setWidth(e*this.getZoom()),this.setHeight(t*this.getZoom()),this.canvasWidth=e,this.canvasHeight=t},this.deactivateSelection=()=>{this.isDrawingMode=!1,this.selection=!1,this.discardActiveObject(),this.forEachObject(e=>{e.selectable=!1}),this.requestRenderAll()},this.activateSelection=()=>{this.isDrawingMode=!1,this.selection=!0,this.forEachObject(e=>{e.selectable=!0})},this.getNextId=()=>(this.latestId+=1,this.latestId),this.getObjectByIds=e=>this.getObjects().filter(t=>e.includes(t.id)),this.serialize=e=>{const t=this.getActiveObjects();return t.length>1&&e.some(e=>t.includes(e))&&(this.discardActiveObject(),this.setActiveObject(new o.fabric.ActiveSelection(t,{canvas:this}))),e.map(e=>this._toObject(e,"toObject",["strokeUniform"]))},this.apply=(e,t)=>{const s=this.getObjectByIds(e);if(s.length&&this.remove(...s),null==t?void 0:t.length){const s=t=>{t.forEach((t,s)=>{t.id=e[s]}),this.add(...t),this.requestRenderAll()};o.fabric.util.enlivenObjects(t,s,"fabric")}else this.requestRenderAll()},this.loadFromJSONAsync=async e=>new Promise(t=>{super.loadFromJSON(e,()=>{t()})}),this.addImage=async(e,t,s)=>new Promise(a=>o.fabric.Image.fromURL(e,e=>{a(this.placeObject(e,t)[0])},s)),this.placeObject=(e,t)=>{var s,{x:a=this.canvasWidth/2,y:i=this.canvasHeight/2}=void 0===t?null!==(s=this.cursor)&&void 0!==s?s:{}:t;this.discardActiveObject();const n=this.getNextId();let r;return e.set({id:n,left:a,top:i,originX:"center",originY:"center"}),ie(e)?(e.canvas=this,e.forEachObject(e=>{e.id=this.getNextId(),this.add(e)}),e.setCoords(),r=e.getObjects()):(this.add(e),r=[e]),this.setActiveObject(e),this.requestRenderAll(),r}}}var re=s(16),le=s.n(re);const ce=(e,t)=>void 0===e?t():e;class oe{}oe.setup=(e,t)=>{const s=new FileReader;return s.onload=()=>{e(s.result)},s.onerror=t,s},oe.readAsText=e=>new Promise((t,s)=>{oe.setup(t,s).readAsText(e)}),oe.readAsDataURL=e=>new Promise((t,s)=>{oe.setup(t,s).readAsDataURL(e)});const he=e=>"application/json"===e.type,de=e=>e.type.startsWith("image/");class ue extends d.MalformedExpressionException{constructor(e="Invalid qboard file"){super(e)}}class pe{static read(e){const t=JSON.parse(e.toString());return pe.readParsed(t)}static readParsed(e){if(!(e=>e instanceof Object&&"qboard-version"in e)(e))throw new ue;const{pages:t}=e;return t}}class ve{constructor(e){this.toString=()=>this.asString=ce(this.asString,()=>JSON.stringify(this.sourceJSON)),this.toBlob=()=>this.asBlob=ce(this.asBlob,()=>new Blob([this.toString()],{type:"application/json"})),this.toURL=()=>{this.asUrl=ce(this.asUrl,()=>window.URL.createObjectURL(this.toBlob()));return[this.asUrl,()=>{void 0!==this.asUrl&&(window.URL.revokeObjectURL(this.asUrl),this.asUrl=void 0)}]},this.download=(e="qboard-file")=>{const[t,s]=this.toURL(),a=document.createElement("a");a.style.display="none",a.href=t,a.download=e,document.body.appendChild(a),a.click(),a.remove(),s()},this.sourceJSON={"qboard-version":1,pages:e}}}class me{constructor(e,t){this.pages=e,this.history=t,this.processFiles=async(e,t)=>{const s=[];for(const a of e)de(a)&&s.push(await this.handleImage(a,t)),he(a)&&await this.handleJSON(a);this.history.add(s)},this.acceptFile=async(e,t)=>{if(!e.length)return"none";const[s]=e;return de(s)?(this.history.add([await this.handleImage(s,t)]),"image"):he(s)?(await this.openFile(s),this.history.clear(!0),"json"):"none"},this.openFile=async e=>(this.pages.savePage(),this.pages.overwritePages(pe.read(await oe.readAsText(e)))),this.handleImage=async(e,t)=>oe.readAsDataURL(e).then(e=>this.pages.canvas.addImage(e.toString(),t)).then(e=>{const[t=0,s=0,a=0,i=0]=[e.width,this.pages.canvas.width,e.height,this.pages.canvas.height];return(t>.8*s||a>.8*i)&&e.scaleToWidth(Math.min(.8*s,.8*i*t/a)),e}),this.handleJSON=async e=>{const t=pe.read(await oe.readAsText(e));return this.pages.insertPagesAfter(t)}}}const ge={version:"4.2.0",objects:[],background:"white"},be=()=>{const e=6e4*(new Date).getTimezoneOffset();return new Date(Date.now()-e).toISOString().slice(0,-8).replace(/\D/g,"-")};class ye{constructor(e,t,s,a,i=[ge]){this.canvas=e,this.canvasWidth=t,this.canvasHeight=s,this.updateState=a,this.pagesJSON=i,this.currentIndex=0,this.savePage=()=>{this.pagesJSON[this.currentIndex]=this.canvas.toObject(["id","strokeUniform"])},this.loadPage=async(e,t=!0)=>(t&&this.savePage(),e===this.currentIndex&&t||(await this.canvas.loadFromJSONAsync(this.pagesJSON[e]),this.currentIndex=e,this.updateState()),e),this.previousOrNewPage=()=>0===this.currentIndex?this.insertPagesBefore([ge],!0):this.loadPage(this.currentIndex-1),this.nextOrNewPage=()=>this.currentIndex===this.pagesJSON.length-1?this.insertPagesAfter([ge],!0):this.loadPage(this.currentIndex+1),this.export=async()=>{this.savePage();const e=[],t=this.currentIndex;for(const t of this.pagesJSON)await this.canvas.loadFromJSONAsync(t),e.push({svg:this.canvas.toSVG(),width:this.canvasWidth/2});const s={pageSize:{width:this.canvasWidth/2,height:this.canvasHeight/2},pageMargins:[0,0],content:e};le.a.createPdf(s).download(`qboard-${be()}.pdf`),await this.canvas.loadFromJSONAsync(this.pagesJSON[t])},this.saveFile=()=>{this.savePage(),new ve(this.pagesJSON).download(`qboard-${be()}.json`),this.canvas.modified=!1},this.overwritePages=async(e=[ge])=>!(this.canvas.modified&&!this.pagesJSON.every(e=>0===e.objects.length)&&!window.confirm("Your work will be overwritten. Are you sure you wish to continue?"))&&(this.pagesJSON=e,await this.loadPage(0,!1),this.canvas.modified=!1,!0),this.insertPagesBefore=async(e=[ge],t=!1)=>(this.savePage(),this.pagesJSON.splice(this.currentIndex,0,...e),t||(this.canvas.modified=!0),this.loadPage(this.currentIndex,!1)),this.insertPagesAfter=async(e=[ge],t=!1)=>(this.pagesJSON.splice(this.currentIndex+1,0,...e),t||(this.canvas.modified=!0),this.loadPage(this.currentIndex+1,!0))}}class fe{constructor(e,t,s){this.canvas=e,this.pages=t,this.updateState=s,this.history=[],this.redoStack=[],this.selection=null,this.locked=!1,this.execute=(e={})=>{e.clear&&this.clear(e.clear[0]),this.add(e.add),this.remove(e.remove)},this.add=e=>{(null==e?void 0:e.length)&&this.save({newObjects:e})},this.remove=e=>{(null==e?void 0:e.length)&&this.save({oldObjects:e})},this.clear=(e=!1)=>{this.history=[],e&&(this.redoStack=[]),this.updateState()},this.store=e=>{this.locked||(this.locked=!0,this.selection=this.canvas.serialize(e),this.locked=!1)},this.modify=e=>this.save({oldObjects:this.selection,newObjects:e}),this.save=({oldObjects:e,newObjects:t})=>{if(this.locked)return;const s=t||e;this.locked=!0,this.history.push({ids:s.map(e=>e.id),oldObjects:t?e:this.canvas.serialize(e),newObjects:t&&this.canvas.serialize(t),page:this.pages.currentIndex}),this.locked=!1,this.redoStack=[],this.canvas.modified=!0,this.updateState()},this.undo=async()=>{this.history.length&&(this.canvas.discardActiveObject(),await this.move(this.history,this.redoStack,!0))},this.redo=async()=>{this.redoStack.length&&await this.move(this.redoStack,this.history,!1)},this.move=async(e,t,s)=>{if(!e.length)return;this.locked=!0;const a=e.pop();await this.pages.loadPage(a.page),this.canvas.apply(a.ids,s?a.oldObjects:a.newObjects),t.push(a),this.locked=!1,this.canvas.modified=!0,this.updateState()}}}class we{constructor(e,t,s,a,i,n){this.canvas=e,this.pages=t,this.files=s,this.history=a,this.canvasWidth=i,this.canvasHeight=n,this.copy=()=>{const e=this.canvas.getActiveObject();return e?(e.clone(e=>{this.clipboard=e}),e):null},this.cut=()=>{const e=this.copy();return!!e&&(this.canvas.discardActiveObject(),ie(e)?(e.forEachObject(e=>{this.canvas.remove(e)}),this.history.remove(e.getObjects())):(this.canvas.remove(e),this.history.remove([e])),this.canvas.requestRenderAll(),!0)},this.paste=()=>{if(void 0!==this.clipboard)return this.clipboard.clone(e=>this.history.add(this.canvas.placeObject(e)))},this.pasteExternal=async e=>{await this.files.processFiles(e.clipboardData.files)},document.addEventListener("paste",this.pasteExternal)}}const Se=[[0,0],[20,15],[5,10]];class Ee{constructor(e,t,s,a){this.currentStyle=e,this.drawerOptions=t,this.freeDrawingBrush=s,this.updateState=a,this.set=(e,t,s)=>{if(null!==e&&(this.currentStyle.dash=e,this.drawerOptions.strokeDashArray=Se[e],this.freeDrawingBrush.strokeDashArray=Se[e]),null!==t&&(this.currentStyle.stroke=t,this.drawerOptions.stroke=t,this.freeDrawingBrush.color=t),null!==s&&(this.currentStyle.fill=s),null!==t||null!==s)switch(this.currentStyle.fill){case 0:this.drawerOptions.fill="transparent";break;case 1:this.drawerOptions.fill=this.currentStyle.stroke;break;case 2:this.drawerOptions.fill=this.currentStyle.stroke+"11"}this.updateState()}}}s(51);window.qboard=new class{constructor(e,t,s,a){this.canvasElement=e,this.baseCanvasElement=t,this.canvasWidth=s,this.canvasHeight=a,this.currentStyle={dash:0,stroke:"#000000",fill:0},this.drawerOptions={fill:"transparent",stroke:"#000000",strokeWidth:4,selectable:!1,strokeDashArray:[0,0],strokeUniform:!0},this.dragActive=!1,this.isDown=!1,this.strict=!1,this.globalState={},this.updateState=()=>{var e;null===(e=null==this?void 0:this.callback)||void 0===e||e.call(this,{dragActive:this.dragActive,currentPage:this.pages.currentIndex+1,totalPages:this.pages.pagesJSON.length,currentStyle:this.currentStyle,canUndo:this.history.history.length>0,canRedo:this.history.redoStack.length>0,keyMap:this.keyboard.keyMap})},this.switchTool=async(e=this.tools.Move)=>{e!==this.activeTool&&await e.activate()&&(this.activeTool.deactivate(),e.isBrush()||e.requiresBase()?(this.baseCanvas.activateSelection(),this.canvasElement.parentElement.style.display="none"):(this.baseCanvas.deactivateSelection(),this.canvasElement.parentElement.style.display="block"),e.isBrush()&&await e.setBrush(this.baseCanvas.freeDrawingBrush,this.drawerOptions),this.activeTool=e,this.baseCanvas.isDrawingMode=this.activeTool.isBrush(),this.updateState())},this.windowResize=()=>{void 0!==this.resizeCooldown&&clearTimeout(this.resizeCooldown),this.resizeCooldown=setTimeout(()=>{this.canvas.fitToWindow(this.canvasWidth,this.canvasHeight),this.baseCanvas.fitToWindow(this.canvasWidth,this.canvasHeight)},100)},this.mouseDown=async e=>{if(!this.activeTool.isDrawing())return;const{x:t,y:s}=this.canvas.getPointer(e.e);this.isDown=!0,this.currentObject=await this.activeTool.draw(t,s,this.drawerOptions),this.currentObject.id=this.baseCanvas.getNextId(),this.canvas.add(this.currentObject),this.canvas.requestRenderAll()},this.mouseMove=async e=>{var t,s;if(!this.activeTool.isDrawing()||!this.isDown)return;const{x:a,y:i}=this.canvas.getPointer(e.e);void 0!==this.currentObject&&await(null===(s=(t=this.activeTool).resize)||void 0===s?void 0:s.call(t,this.currentObject,a,i,this.strict)),this.canvas.requestRenderAll()},this.mouseUp=()=>{this.activeTool.isDrawing()&&(this.isDown=!1,this.baseCanvas.add(o.fabric.util.object.clone(this.currentObject)),this.baseCanvas.requestRenderAll(),this.currentObject,this.canvas.remove(this.currentObject),this.canvas.requestRenderAll(),this.history.add([this.currentObject]))},this.setDragActive=e=>{this.dragActive=e,this.updateState()},this.drop=async e=>{e.e.stopPropagation(),e.e.preventDefault(),await this.updateCursor(e),this.setDragActive(!1),await this.files.processFiles(e.e.dataTransfer.files)},this.pathCreated=e=>{this.activeTool.isBrush()&&this.activeTool.pathCreated(e)},this.selectionCreated=e=>{if(!this.history.locked)return this.history.store(e.selected)},this.objectModified=e=>{const t=ie(e.target)?e.target.getObjects():[e.target];this.history.modify(t),this.history.store(t)},this.updateCursor=e=>{const{x:t,y:s}=this.baseCanvas.getPointer(e.e);this.baseCanvas.cursor={x:t,y:s}};const i=new URLSearchParams(window.location.search);this.baseCanvas=new ne(t,{backgroundColor:"white",renderOnAddRemove:!1,selection:!1,targetFindTolerance:15}),this.canvas=new ne(e,{renderOnAddRemove:!1,selection:!1}),this.pages=new ye(this.baseCanvas,this.canvasWidth,this.canvasHeight,this.updateState);{const e=i.get("json");null!==e&&d.Network.loadJSON(e).then(pe.readParsed).then(this.pages.overwritePages).catch(console.error)}this.history=new fe(this.baseCanvas,this.pages,this.updateState),this.files=new me(this.pages,this.history),this.clipboard=new we(this.baseCanvas,this.pages,this.files,this.history,this.canvasWidth,this.canvasHeight),this.style=new Ee(this.currentStyle,this.drawerOptions,this.baseCanvas.freeDrawingBrush,this.updateState),this.tools=ae(this.baseCanvas,this.history,this.clipboard),this.action=new g(this.switchTool,this.tools,this.currentStyle,this.pages,this.files,this.history,this.clipboard,this.style.set,this.globalState),this.keyboard=new y(this.action.doAction,e=>this.strict=e,this.updateState),this.activeTool=new _(this.baseCanvas,this.history,this.clipboard),this.switchTool(),this.windowResize(),window.onresize=this.windowResize,window.onbeforeunload=()=>this.baseCanvas.modified||null,this.canvas.on("mouse:down",this.mouseDown),this.canvas.on("mouse:move",this.mouseMove),this.canvas.on("mouse:up",this.mouseUp),this.baseCanvas.on("dragenter",()=>this.setDragActive(!0)),this.baseCanvas.on("dragleave",()=>this.setDragActive(!1)),this.baseCanvas.on("drop",this.drop),this.baseCanvas.on("path:created",this.pathCreated),this.baseCanvas.on("selection:created",this.selectionCreated),this.baseCanvas.on("object:modified",this.objectModified),this.baseCanvas.on("mouse:move",this.updateCursor)}}(document.querySelector("#QBoard"),document.querySelector("#BaseQBoard"),1600,900),r.a.render(i.a.createElement(W,{qboard:window.qboard}),document.querySelector("#Overlay"))}},[[52,1,2]]]);
//# sourceMappingURL=main.433e327c.js.map